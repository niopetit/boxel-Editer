# カメラ仕様書

## 1. 概要

Boxel Editorのカメラシステムは、3D空間でのボクセルオブジェクト編集を効率的に行うため、回転、パン、ズーム操作をサポートしています。

## 2. カメラ操作一覧

### 2.1 回転操作（WASD キー）

カメラの視点を回転させます。

| キー | 操作内容 |
| --- | --- |
| **W** | 上方向回転（オブジェクトが下に回転） |
| **A** | 左方向回転（オブジェクトが右に回転） |
| **S** | 下方向回転（オブジェクトが上に回転） |
| **D** | 右方向回転（オブジェクトが左に回転） |

**仕様詳細**:
- 回転は3D空間の中心（座標(0, 0, 0)）を基準に行われる
- 回転感度は一定に保つ
- 連続した回転操作に対応

### 2.2 パン操作（矢印キー / 十字キー）

カメラの視点を並進移動（パン）させます。

| キー | 操作内容 |
| --- | --- |
| **↑（上矢印）** | 上方向パン |
| **↓（下矢印）** | 下方向パン |
| **←（左矢印）** | 左方向パン |
| **→（右矢印）** | 右方向パン |

**仕様詳細**:
- パンはカメラの水平・垂直軸に沿った移動
- 移動速度は一定に保つ
- 連続した移動操作に対応

### 2.3 ズーム操作（Q キー）

カメラの視野（FOV）またはカメラ距離を調整し、オブジェクトの拡大・縮小表示を実現します。

| キー組合せ | 操作内容 |
| --- | --- |
| **Q** | 拡大（ズームイン） |
| **Shift + Q** | 縮小（ズームアウト） |

**仕様詳細**:
- 拡大・縮小は段階的に実行される
- ズーム中心はオブジェクト中心（座標(0, 0, 0)）
- ズーム感度は適切に調整される

## 3. カメラパラメータ

### 3.1 座標系

- **原点**: (0, 0, 0)
- **初期オブジェクト中心**: 座標(0, 0, 0)
- **初期カメラ位置**: オブジェクトを適切に視認できる位置に配置

### 3.2 回転の基準

- 回転中心: オブジェクト中心（0, 0, 0）
- X軸回転: WASD キーの垂直操作（W/S）
- Y軸回転: WASD キーの水平操作（A/D）

### 3.3 パンの基準

- 移動対象: カメラビュー全体
- 水平移動: 矢印キー左右（←/→）
- 垂直移動: 矢印キー上下（↑/↓）

## 4. パフォーマンス

- カメラ操作は60FPS以上のフレームレートを維持
- 複数キー同時押しに対応

## 5. ファイル保存時のカメラ状態

- カメラ状態（位置、回転角度など）は blw形式ファイルに記録される
- blw 読み込み時に前回のカメラ状態が完全に復元される
- アンドゥ・リドゥ機能によるカメラ操作の履歴管理に対応

## 6. 技術的実装

### 6.1 使用ライブラリ

- **Three.js**: カメラオブジェクト管理
- **TypeScript**: イベントハンドリング実装

### 6.2 イベントハンドリング

キー入力は以下の優先度で処理される：
1. キーダウンイベントでキー状態を記録
2. キーアップイベントでキー状態をクリア
3. アニメーションフレーム内でアクティブなキーから操作を実行
