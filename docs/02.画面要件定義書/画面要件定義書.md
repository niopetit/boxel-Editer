# 画面要件定義書

## 1. 画面構成

Boxel Editorは以下の主要エリアで構成される：

### 1.1 3D表示エリア（メインキャンバス）
- **位置**: 画面中央～右側
- **機能**: 
  - ボクセルオブジェクトの3D表示
  - マウス操作による面・ボクセル選択
  - シェーダーによる頂点ハイライト表示
  - 選択状態の視覚フィードバック
  - メインオブジェクト（編集対象）と隣接オブジェクト（編集不可）の表示
- **複数オブジェクト表示**:
  - メインオブジェクト：通常の表示（青色頂点、カラー着色対応）
  - 隣接オブジェクト：視覚的に区別される表現
    - 色調：グレースケール表示またはやや淡い色合い
    - 透明度：やや半透明表示（推奨: 不透明度70%～80%）
    - または異なる材質（マット調など）で区別
    - 枠線：隣接オブジェクトの輪郭をわずかに強調表示
  - オブジェクト間の隣接配置：6方向（上下左右前後）に隣接したレイアウト

### 1.2 左側パネル
#### 1.2.1 プロジェクト情報
- グリッド設定（X軸個数、Y軸個数）
- 現在の頂点総数表示
- オブジェクト統計情報

#### 1.2.2 カラーパレット
- 自作実装のカラーパレット
- 色選択インターフェース
- カスタムカラー管理機能

#### 1.2.3 隣接オブジェクト管理
- **配置ボタン**: 「隣接オブジェクトを追加」ボタン
- **配置方向選択**: 6方向（上↑、下↓、左←、右→、前、後）の選択インターフェース
- **ファイル選択**: ダイアログからglwまたはgltf形式ファイルを選択
- **配置済みオブジェクト一覧**:
  - 配置されている隣接オブジェクトのリスト表示
  - 各オブジェクトの位置情報（方向）を表示
  - 削除ボタン：隣接オブジェクトを個別に削除可能
- **編集不可表示**: 隣接オブジェクトは操作不可であることを明記

#### 1.2.4 操作ガイド
- キーバインド表示
- 操作説明
- 隣接オブジェクトの操作制限事項を明示

### 1.3 上部メニューバー
- **ファイルメニュー**
  - 新規作成（Command + N / Ctrl + N）
  - 開く（Command + O / Ctrl + O）: glw形式
  - 保存（Command + S / Ctrl + S）: glw形式
  - エクスポート（Command + Shift + E / Ctrl + Shift + E）: gltf形式
- **編集メニュー**
  - アンドゥ（Command + Z / Ctrl + Z）
  - リドゥ（Command + Shift + Z / Ctrl + Shift + Z）

### 1.4 ステータスバー（下部）
- **現在の選択状態表示**: 例）「面 #12 選択中」「ボクセル選択解除」
- **座標情報**: 例）「カーソル位置: (5, 8, 3)」
- **操作ヒント**: 例）「Shift + 右クリックでボクセル追加」
- **エラー表示**: 不正な操作時の警告メッセージ

## 2. UI要素の詳細仕様

### 2.1 3D表示エリア
- **背景色**: 暗いグレー（#333333推奨）
- **グリッド表示**: 必要に応じて背景グリッドを表示
- **頂点表示**: 青色（#4A90E2推奨）で頂点を球体で表示
- **選択状態**: 
  - 面選択時：該当面をハイライト（黄色など）
  - ボクセル選択時：ボクセル全体をハイライト
- **複数オブジェクト表示**:
  - メインオブジェクト：標準表示（頂点は青色、面は着色対応）
  - 隣接オブジェクト：
    - 背景色：グレースケール（#888888推奨）または淡い色合い
    - 透明度：約70%～80%の半透明表示
    - 頂点：淡い灰色で表示
    - 輪郭線：やや濃いグレーで囲線表示
    - 選択不可：クリック時に反応しない

### 2.2 左側パネル配置

```
┌─────────────────────────────┐
│ プロジェクト情報            │
│ グリッド：32×32             │
│ 頂点数：1,234               │
├─────────────────────────────┤
│  カラーパレット             │
│ [■] [■] [■] [+]           │
│ [■] [■] [■]               │
│                             │
│ カラー編集エリア            │
│ RGB: 255, 128, 0            │
├─────────────────────────────┤
│ 隣接オブジェクト管理        │
│ [配置追加]                  │
│ 配置済み:                   │
│ ☐ 上：object_1  [✕]       │
│ ☐ 左：object_2  [✕]       │
├─────────────────────────────┤
│   操作ガイド                │
│ カメラ操作:                 │
│ W/A/S/D: 回転              │
│ ↑↓←→: パン                │
│ Q / Shift+Q: 拡大縮小      │
│                             │
│ ボクセル操作:               │
│ 左クリック: 選択            │
│ Shift+右: 追加              │
│ Cmd+右: 削除                │
│ Option+右: 着色             │
│ Cmd+Z/Y: 戻す/進む         │
│                             │
│ ※隣接ｵﾌﾞｼﾞｪｸﾄは編集不可   │
└─────────────────────────────┘
```

### 2.2.1 プロジェクト情報
- **グリッド表示**: X軸×Y軸の形式
  - X軸値（1～50）
  - Y軸値（1～50）
- **頂点数表示**: リアルタイム更新（メインオブジェクトのみ）
- **統計情報**: ボクセル数、面数などの表示（メインオブジェクトのみ）

### 2.2.2 隣接オブジェクト管理詳細
- **配置追加ボタン**:
  - テキスト：「隣接オブジェクトを追加」
  - 押下時：ダイアログが開く
- **配置ダイアログ**:
  - **ステップ1 - 方向選択**:
    - 6方向ラジオボタン：上（↑）、下（↓）、左（←）、右（→）、前、後
    - 視覚的には3D立方体で方向を表示
  - **ステップ2 - ファイル選択**:
    - ファイルブラウザでglw形式ファイルを選択
    - 複数選択可（同一方向に複数配置）
- **配置済みオブジェクト一覧**:
  - 各オブジェクトを行で表示
  - 表示内容：[配置方向] ファイル名 [削除ボタン]
  - 削除ボタン：クリックで該当オブジェクトのみ削除
- **編集制限表示**:
  - テキスト：「※隣接オブジェクトは編集不可」
  - スタイル：グレー色で警告表示

### 2.3 カラーパレット詳細
- **表示方式**: 3×Nグリッド状のスウォッチ表示
- **色数**: ユーザーが追加可能（スクロール対応）
- **操作**:
  - 色スウォッチをクリックして選択
  - 選択中の色は枠線で強調表示
  - 「+」ボタンで新規色追加
  - 色をダブルクリックで編集
- **カラー編集機能**:
  - RGB値入力（0～255）
  - カラーピッカー（六角形または正方形型）
  - 16進数カラーコード入力対応
- **色の永続化**: 選択した色は自動保存される

### 2.4 グリッド設定ダイアログ
- **表示**: 起動時に表示
- **入力項目**:
  - X軸個数（1～50）
  - Y軸個数（1～50）
- **制約**: 数値のみ入力可能、範囲外は警告


## 3. インタラクションフロー

### 3.1 ボクセル追加フロー
1. 左クリックで面を選択
2. Shift + 右クリックでボクセルを追加
3. 新しいボクセルが表示される
4. 頂点数が自動更新

### 3.2 面着色フロー
1. 左クリックで面を選択
2. パレットから色を選択
3. Option + 右クリックで面に着色
4. 面の色が変更される

### 3.3 ファイル保存フロー
1. メニュー「ファイル」→「保存」
2. ファイル保存ダイアログ表示
3. ファイル名を入力
4. 保存完了

### 3.4 ファイル読み込みフロー
1. メニュー「ファイル」→「開く」
2. ファイル選択ダイアログ表示
3. glw形式ファイルを選択
4. 前回の状態が復元される
   - グリッド設定
   - ボクセル配置
   - 面着色
   - カメラ状態
   - 隣接オブジェクト配置情報

### 3.5 隣接オブジェクト配置フロー
1. 左側パネルの「隣接オブジェクトを追加」ボタンをクリック
2. 配置ダイアログが表示される
   - **ステップ1**: 6方向のいずれかを選択（ラジオボタンまたは3D表示）
   - **ステップ2**: ファイルブラウザでglw形式ファイルを選択
3. 確認ボタンで配置を確定
4. 3D表示エリアに隣接オブジェクトが表示される（グレースケール、半透明）
5. 配置済みオブジェクト一覧に該当オブジェクトが追加される

### 3.6 隣接オブジェクト削除フロー
1. 左側パネルの「配置済み」リストで削除対象を確認
2. 該当オブジェクトの削除ボタン（✕）をクリック
3. 確認ダイアログが表示される（オプション）
4. 確認後、3D表示から隣接オブジェクトが削除される
5. リストからも削除される

## 4. 視覚フィードバック

### 4.1 ハイライト表示
- **面選択時**: 選択された面が黄色でハイライト（メインオブジェクトのみ）
- **ボクセル選択時**: ボクセルの輪郭が強調表示（メインオブジェクトのみ）
- **頂点表示**: 
  - メインオブジェクト：常時青色で表示、選択時はサイズが大きくなる
  - 隣接オブジェクト：淡い灰色で表示、選択不可

### 4.2 マウスオーバー効果
- マウスが面上にある時、その面がわずかにハイライト（メインオブジェクトのみ）
- 隣接オブジェクトでは応答なし（クリッカビリティなし）
- クリッカビリティの示唆

### 4.3 カラーパレット選択状態
- 選択中の色がボーダーで囲まれる
- または背景色が変わる

### 4.4 隣接オブジェクト表示フィードバック
- **視覚的区別**:
  - メインオブジェクト：標準色（カラー着色対応）
  - 隣接オブジェクト：グレースケール（#888888など）＋半透明（70%～80%）
- **境界表示**: オブジェクト間の隣接境界を明確に表示
- **選択不可表示**: マウスクリックで隣接オブジェクトは選択不可であることを示す

## 5. レスポンシブ対応

- **最小ウィンドウサイズ**: 1024×768推奨
- **解像度対応**: 1920×1080以上を標準サイズとして設計

## 6. アクセシビリティ

- キーボード操作のみでも全機能を使用可能
- カラーコントラスト：WCAG AA準拠を目指す
- フォントサイズ：12px以上を推奨

## 7. エラーハンドリング

### 7.1 エラーメッセージ表示
- **位置**: ステータスバーおよびダイアログで表示
- **内容例**:
  - 「グリッド値は1～50の整数で入力してください」
  - 「ファイルの読み込みに失敗しました」
  - 「ボクセル数が上限に達しています」
- **表示色**: 赤色（#E74C3C推奨）

### 7.2 警告表示
- **上限到達時**: グリッド数またはボクセル数が上限に近づいた場合に警告
- **無効な操作**: 操作不可のときはボタンを無効化（グレーアウト）

### 7.3 確認ダイアログ
- **保存なしで終了**: 「変更を保存しますか？」
- **ファイル上書き**: 「既存ファイルを上書きしますか？」
