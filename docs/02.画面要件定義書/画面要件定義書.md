# 画面要件定義書

## 1. 画面構成

Boxel Editorは以下の主要エリアで構成される：

### 1.1 3D表示エリア（メインキャンバス）
- **位置**: 画面中央（左右サイドパネルの間）
- **機能**: 
  - ボクセルオブジェクトの3D表示
  - マウス操作による面・ボクセル選択
  - シェーダーによる頂点ハイライト表示
  - 選択状態の視覚フィードバック
  - メインオブジェクト（編集対象）と隣接オブジェクト（編集不可）の表示
- **複数オブジェクト表示**:
  - メインオブジェクト：通常の表示（着色対応）
  - 隣接オブジェクト：読み込んだGLTFの元のマテリアル・テクスチャを保持して表示
  - オブジェクト間の隣接配置：6方向（上下左右前後）に隣接したレイアウト

### 1.2 左側パネル（カラーパレット）
**幅**: 固定280px

#### 1.2.1 カラーピッカーセクション
- ネイティブカラーピッカー（HTML color input）
- 現在色のプレビュー表示
- HEX値表示
- カラー名入力フィールド
- 「保存」ボタン

#### 1.2.2 プリセットカラーセクション
- 9色の固定プリセット
- 3列グリッド表示

#### 1.2.3 登録済みカラーセクション
- ユーザー保存のカスタムカラー（最大32個）
- 4列グリッド表示
- 各スウォッチに削除ボタン

### 1.3 右側パネル（隣接オブジェクト管理）
**幅**: 固定240px

#### 1.3.1 パネルヘッダー
- 「隣接オブジェクト」タイトル
- 折りたたみトグル

#### 1.3.2 追加ボタン
- 「+ 隣接オブジェクトを追加」ボタン

#### 1.3.3 配置済みオブジェクト一覧
- 方向ラベル（上、下、左、右、前、後）
- ファイル名
- サイズ表示（X×Y）
- アクションボタン：
  - 表示/非表示切り替え（👁/👁‍🗨）
  - 回転（↻）
  - 削除（✕）

### 1.4 上部ツールバー
- **位置**: 画面上部、メインキャンバスの上
- **ボタン一覧**:
  - 追加（選択したボクセル面にボクセル追加）
  - 削除（選択したボクセルを削除）
  - 着色（選択した面を着色）
  - 開く（glwファイルを開く）
  - 保存（glwファイルに保存）
  - エクスポート（gltf形式でエクスポート）
  - アンドゥ（操作を元に戻す）
  - リドゥ（操作をやり直す）

### 1.5 ステータスバー
- **位置**: ツールバーの下
- **表示内容**:
  - グリッドサイズ: X × Y × Z
  - 頂点数
  - ボクセル数
  - 選択中のボクセルID
  - 現在の選択色
  - 隣接オブジェクト数

### 1.6 操作ガイド
- **位置**: ステータスバーの下
- **表示内容**: 「クリック=選択 · WASD=回転 · 矢印=パン · Q=ズーム」

## 2. UI要素の詳細仕様

### 2.1 3D表示エリア
- **背景色**: 暗いグレー（#333333）
- **グリッド表示**: 背景グリッド（GridHelper）
- **軸表示**: 軸ヘルパー（AxesHelper）
- **選択状態**: 
  - ホバー時：該当面を青色（#0099FF）でハイライト
  - 選択時：該当面を黄色（#FFFF00）でハイライト
- **隣接オブジェクト表示**:
  - 元のマテリアル・テクスチャを保持
  - 選択不可（クリック時に反応しない）

### 2.2 左側パネル配置

```
┌─────────────────────────────┐
│  カラーパレット             │
├─────────────────────────────┤
│ [カラーピッカー]            │
│ 現在の色: [■■■■] #FF0000   │
│ 名前: [_______________]     │
│ [保存]                      │
├─────────────────────────────┤
│ プリセット                  │
│ [■] [■] [■]               │
│ [■] [■] [■]               │
│ [■] [■] [■]               │
├─────────────────────────────┤
│ 登録済みカラー              │
│ [■✕] [■✕] [■✕] [■✕]      │
│ [■✕] [■✕] [■✕] [■✕]      │
│ ...                         │
└─────────────────────────────┘
```

### 2.3 右側パネル配置

```
┌─────────────────────────────┐
│ 隣接オブジェクト        [▼] │
├─────────────────────────────┤
│ [+ 隣接オブジェクトを追加]  │
├─────────────────────────────┤
│ 上(Y+) model.gltf 8×8       │
│        [👁] [↻] [✕]        │
├─────────────────────────────┤
│ 左(X-) wall.glb 4×8         │
│        [👁] [↻] [✕]        │
├─────────────────────────────┤
│ (配置されている隣接オブジェ │
│  クトはありません)          │
└─────────────────────────────┘
```

### 2.4 ツールバー配置

```
┌────────────────────────────────────────────────────────────────┐
│ [追加] [削除] [着色] [開く] [保存] [エクスポート] [⟲] [⟳]    │
└────────────────────────────────────────────────────────────────┘
```

### 2.5 カラーパレット詳細
- **表示方式**: グリッド状のスウォッチ表示
- **プリセットカラー**: 9色（Red, Green, Blue, Yellow, Cyan, Magenta, White, Black, Gray）
- **登録済みカラー**: 最大32個
- **操作**:
  - 色スウォッチをクリックして選択
  - 選択中の色は赤色ボーダーで強調表示
  - 「保存」ボタンで新規色追加
  - 削除ボタン（✕）で色を削除
- **色の永続化**: ローカルストレージで自動保存

### 2.6 隣接オブジェクト配置ダイアログ
- **表示**: 「追加」ボタンクリック時にモーダル表示
- **入力項目**:
  - **方向選択**: 6方向ラジオボタン
    - 上 (Y+)
    - 下 (Y-)
    - 左 (X-)
    - 右 (X+)
    - 前 (Z-)
    - 後 (Z+)
  - **ファイル選択**: GLTF/GLBファイルブラウザ
- **操作フロー**:
  1. 方向を選択
  2. 「ファイルを選択」ボタンをクリック
  3. ファイルダイアログでGLTF/GLBファイルを選択
  4. 自動的にオブジェクトが追加されダイアログが閉じる

## 3. インタラクションフロー

### 3.1 ボクセル追加フロー
1. メインキャンバス上でボクセル面をクリック（黄色ハイライト）
2. ツールバーの「追加」ボタンをクリック
3. 選択した面の法線方向に新しいボクセルが追加される
4. 頂点数・ボクセル数が自動更新

### 3.2 ボクセル削除フロー
1. メインキャンバス上でボクセル面をクリック（黄色ハイライト）
2. ツールバーの「削除」ボタンをクリック
3. 選択したボクセルが削除される
4. 頂点数・ボクセル数が自動更新

### 3.3 面着色フロー
1. 左パネルのカラーパレットから色を選択
2. メインキャンバス上でボクセル面をクリック（黄色ハイライト）
3. ツールバーの「着色」ボタンをクリック
4. 選択した面の色が変更される

### 3.4 ファイル保存フロー
1. ツールバーの「保存」ボタンをクリック
2. ファイル保存ダイアログ表示（デフォルト: boxel_project_YYYY-MM-DD_HHMM.glw）
3. ファイル名を入力して保存
4. 保存完了アラート表示

### 3.5 ファイル読み込みフロー
1. ツールバーの「開く」ボタンをクリック
2. ファイル選択ダイアログ表示
3. glw形式ファイルを選択
4. 前回の状態が復元される
   - グリッド設定
   - ボクセル配置
   - 面着色
5. 読み込み完了アラート表示

### 3.6 GLTFエクスポートフロー
1. ツールバーの「エクスポート」ボタンをクリック
2. ファイル保存ダイアログ表示（デフォルト: boxel_YYYY-MM-DD.gltf）
3. ファイル名を入力して保存
4. エクスポート完了アラート表示

### 3.7 隣接オブジェクト追加フロー
1. 右パネルの「+ 隣接オブジェクトを追加」ボタンをクリック
2. 配置ダイアログが開く
3. 配置方向を選択（6方向から選択）
4. 「ファイルを選択」ボタンをクリック
5. GLTF/GLBファイルを選択
6. オブジェクトが3Dシーンに追加される
7. 右パネルの一覧に追加される

### 3.8 隣接オブジェクト回転フロー
1. 右パネルの配置済みオブジェクト一覧から対象を選択
2. 回転ボタン（↻）をクリック
3. Y軸周りに90度時計回りに回転

### 3.9 隣接オブジェクト削除フロー
1. 右パネルの配置済みオブジェクト一覧から対象を選択
2. 削除ボタン（✕）をクリック
3. オブジェクトが3Dシーンから削除される
4. 一覧からも削除される

### 3.10 アンドゥ・リドゥフロー
1. ツールバーの「アンドゥ」ボタンをクリック → 直前の操作を取り消し
2. ツールバーの「リドゥ」ボタンをクリック → 取り消した操作をやり直し
3. ボタンは操作履歴に応じて有効/無効が切り替わる

## 4. 視覚フィードバック

### 4.1 ハイライト色
| 状態 | 色 | HEX |
|------|-----|------|
| ホバー | 青色 | #0099FF |
| 選択 | 黄色 | #FFFF00 |
| 選択色ボーダー | 赤色 | - |

### 4.2 ボタン状態
- **通常**: 青色背景（#4a90e2）
- **ホバー**: 暗い青色背景（#3873b8）
- **無効**: グレー背景（#555）、テキスト色（#999）

### 4.3 パネルスタイル
- **背景色**: 暗いグレー（#252525）
- **ボーダー**: #444
- **テキスト色**: 白（#fff）

## 5. レスポンシブ対応

### 5.1 最小ウィンドウサイズ
- **幅**: 900px
- **高さ**: 670px

### 5.2 パネル固定幅
- **左パネル**: 280px
- **右パネル**: 240px
- **メインキャンバス**: 残りの幅

## 6. アクセシビリティ

### 6.1 ダブルクリック無効化
- canvas以外の要素でダブルクリックを無効化
- テキスト選択を無効化（user-select: none）

### 6.2 ツールチップ
- 各ボタンにtitle属性でツールチップを表示
